<!DOCTYPE html>
<html lang="es" class="cyber-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>{% block title %}Chipi IA - Asistente Virtual Seguro para Adultos Mayores{% endblock %}</title>
    <meta name="description" content="Chipi IA ofrece soluciones de ciberseguridad y asistencia virtual especializada para adultos mayores. Protección sin complicaciones.">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    /* Variables de diseño cybernético optimizadas */
    :root {
        --cyber-primary: #0d8bff;
        --cyber-accent: #00c896;
        --cyber-neon: #7e57c2;
        --cyber-dark: #0a0e17;
        --cyber-darker: #050811;
        --cyber-light: #1a2236;
        --cyber-glow: rgba(13, 139, 255, 0.5);
        --cyber-text: #ffffff;
        --cyber-text-secondary: #a0abc0;
        --success-color: #47d7ac;
        --error-color: #ff6b6b;
        --warning-color: #ffd93d;
        --info-color: #4fc3f7;
        --mobile-padding: 1rem;
        --desktop-padding: 2rem;
        --touch-target-min: 44px;
        --border-radius: 12px;
        --border-radius-lg: 20px;
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.2);
        --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.3);
        --transition-fast: 0.2s ease;
        --transition-normal: 0.3s ease;
        --transition-slow: 0.5s ease;
    }

    /* Reset y estilos base optimizados */
    *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    html {
        font-size: 16px;
        text-size-adjust: 100%;
        -webkit-text-size-adjust: 100%;
        height: 100%;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        font-size: 1rem;
        line-height: 1.6;
        color: var(--cyber-text);
        background: linear-gradient(135deg, var(--cyber-darker) 0%, var(--cyber-dark) 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
    }

    /* Contenedor principal */
    .cyber-container {
        flex: 1;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: var(--mobile-padding);
        display: flex;
        flex-direction: column;
    }

    @media (min-width: 768px) {
        .cyber-container {
            padding: var(--desktop-padding);
        }
    }

    /* Header optimizado para móviles */
    .cyber-header {
        position: relative;
        background: rgba(26, 34, 54, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid var(--cyber-primary);
        border-radius: var(--border-radius-lg);
        margin: 0 0 1rem 0;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    @media (max-width: 768px) {
        .cyber-header {
            position: sticky;
            top: 0;
            z-index: 1000;
        }
    }

    .logo-container {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .logo-core {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, var(--cyber-primary), var(--cyber-accent));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: white;
        animation: pulse 2s ease-in-out infinite;
    }

    .logo-text {
        font-family: 'Orbitron', sans-serif;
        font-weight: 700;
        font-size: 1.4rem;
        background: linear-gradient(135deg, var(--cyber-primary), var(--cyber-accent));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Navegación para móviles - MEJORADO Y CORREGIDO */
    #mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        color: var(--cyber-text);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: var(--border-radius);
        background: rgba(13, 139, 255, 0.2);
        z-index: 1002;
        width: 44px;
        height: 44px;
        position: relative;
    }

    @media (max-width: 768px) {
        #mobile-menu-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cyber-nav {
            position: fixed;
            top: 0;
            right: -100%;
            width: 80%;
            max-width: 300px;
            height: 100vh;
            background: rgba(26, 34, 54, 0.98);
            backdrop-filter: blur(5px);
            border-left: 1px solid var(--cyber-primary);
            transition: right 0.3s ease;
            z-index: 1001;
            flex-direction: column;
            padding: 5rem 1rem 1rem 1rem;
            overflow-y: auto;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
            display: flex;
        }

        .cyber-nav.active {
            right: 0;
        }

        .cyber-nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            color: var(--cyber-text);
            text-decoration: none;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .cyber-nav-link:hover {
            background: rgba(13, 139, 255, 0.2);
            transform: translateX(-5px);
        }
    }

    /* Para desktop */
    @media (min-width: 769px) {
        .cyber-nav {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .cyber-nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            color: var(--cyber-text);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: background-color 0.3s ease;
        }

        .cyber-nav-link:hover {
            background: rgba(13, 139, 255, 0.2);
        }
    }

    /* Overlay para móviles - MEJORADO */
    .nav-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 999;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .nav-overlay.active {
        display: block;
        opacity: 1;
    }

    /* Contenido principal */
    .cyber-main {
        flex: 1;
        padding: 1rem 0;
    }
    
    /* Tarjetas de contenido */
    .cyber-card {
        background: rgba(26, 34, 54, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid var(--cyber-primary);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .cyber-footer {
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(26, 34, 54, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid var(--cyber-primary);
        border-radius: var(--border-radius-lg);
        text-align: center;
    }

    /* Animaciones */
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    /* Mejoras de accesibilidad */
    @media (prefers-reduced-motion: reduce) {
        * {
            animation: none !important;
            transition: none !important;
        }
    }

    /* Icono de hamburguesa que se transforma en X */
    .hamburger-icon {
        display: block;
        position: relative;
        width: 24px;
        height: 24px;
    }
    
    .hamburger-icon span {
        display: block;
        position: absolute;
        height: 2px;
        width: 100%;
        background: var(--cyber-text);
        border-radius: 2px;
        opacity: 1;
        left: 0;
        transform: rotate(0deg);
        transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    .hamburger-icon span:nth-child(1) {
        top: 6px;
    }
    
    .hamburger-icon span:nth-child(2) {
        top: 11px;
    }
    
    .hamburger-icon span:nth-child(3) {
        top: 16px;
    }
    
    #mobile-menu-toggle.active .hamburger-icon span:nth-child(1) {
        transform: rotate(45deg);
        top: 11px;
    }
    
    #mobile-menu-toggle.active .hamburger-icon span:nth-child(2) {
        opacity: 0;
    }
    
    #mobile-menu-toggle.active .hamburger-icon span:nth-child(3) {
        transform: rotate(-45deg);
        top: 11px;
    }
    </style>
</head>
<body>
    <div class="cyber-container">
        <!-- Header -->
        <header class="cyber-header">
            <div class="logo-container">
                <div class="logo-core">C</div>
                <div class="logo-text">Chipi IA</div>
            </div>
            
            <!-- Botón de menú hamburguesa siempre visible en móviles -->
            <button id="mobile-menu-toggle" aria-label="Abrir menú">
                <div class="hamburger-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>

            <nav id="cyber-nav" class="cyber-nav">
                <a href="/" class="cyber-nav-link"><i class="fas fa-home"></i> Inicio</a>
                
                <!-- Mostrar estos enlaces solo si el usuario está autenticado -->
                {% if session.get('user_id') %}
                <a href="/passwords" class="cyber-nav-link"><i class="fas fa-key"></i> Contraseñas</a>
                <a href="/reminders" class="cyber-nav-link"><i class="fas fa-bell"></i> Recordatorios</a>
                <a href="/contacts" class="cyber-nav-link"><i class="fas fa-address-book"></i> Contactos</a>
                <a href="/chat" class="cyber-nav-link"><i class="fas fa-comment"></i> Chat</a>
                <a href="/logout" class="cyber-nav-link"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
                {% else %}
                <!-- Enlaces para usuarios no autenticados -->
                <a href="/login" class="cyber-nav-link"><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</a>
                <a href="/register" class="cyber-nav-link"><i class="fas fa-user-plus"></i> Registrarse</a>
                {% endif %}
            </nav>
        </header>

        <!-- Overlay para cerrar el menú en móviles -->
        <div class="nav-overlay" id="nav-overlay"></div>

        <!-- Contenido principal -->
        <main class="cyber-main">
            {% block content %}
            <!-- El contenido específico de cada página se insertará aquí -->
            {% endblock %}
        </main>

        <!-- Footer -->
        <footer class="cyber-footer">
            <p>© 2025 OLD-SEGURITY</p>
            <p>Protección sin complicación</p>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const menuToggle = document.getElementById('mobile-menu-toggle');
        const cyberNav = document.getElementById('cyber-nav');
        const navOverlay = document.getElementById('nav-overlay');

        // Inicializar el menú hamburguesa
        if (menuToggle && cyberNav) {
            function toggleMenu() {
                const isActive = cyberNav.classList.toggle('active');
                navOverlay.classList.toggle('active');
                menuToggle.classList.toggle('active');
                document.body.style.overflow = isActive ? 'hidden' : '';
            }

            function closeMenu() {
                cyberNav.classList.remove('active');
                navOverlay.classList.remove('active');
                menuToggle.classList.remove('active');
                document.body.style.overflow = '';
            }

            menuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleMenu();
            });

            if (navOverlay) {
                navOverlay.addEventListener('click', function() {
                    closeMenu();
                });
            }

            // Cerrar el menú al hacer clic en un enlace (útil para móviles)
            const navLinks = document.querySelectorAll('.cyber-nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        closeMenu();
                    }
                });
            });

            // Cerrar menú con la tecla Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && cyberNav.classList.contains('active')) {
                    closeMenu();
                }
            });

            // Ajustar el menú al cambiar el tamaño de la ventana
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    closeMenu();
                }
            });

            // Prevenir problemas de scroll en iOS
            document.addEventListener('touchmove', function(e) {
                if (cyberNav.classList.contains('active')) {
                    e.preventDefault();
                }
            }, { passive: false });
        }

        // Mejorar la compatibilidad con dispositivos móviles
        function checkBackdropFilterSupport() {
            // Detectar si el navegador soporta backdrop-filter
            const testEl = document.createElement('div');
            testEl.style.backdropFilter = 'blur(5px)';
            document.body.appendChild(testEl);
            const supportsBackdrop = window.getComputedStyle(testEl).backdropFilter === 'blur(5px)';
            document.body.removeChild(testEl);
            
            if (!supportsBackdrop && cyberNav) {
                // Si no hay soporte, usar un fondo más sólido
                cyberNav.style.background = 'rgba(26, 34, 54, 0.98)';
                cyberNav.style.backdropFilter = 'none';
            }
        }

        // Verificar soporte al cargar la página
        checkBackdropFilterSupport();
    });
    </script>
</body>
</html>